[{"/Users/eitatachino/Desktop/stripe-react/src/index.js":"1","/Users/eitatachino/Desktop/stripe-react/src/App.js":"2","/Users/eitatachino/Desktop/stripe-react/src/reportWebVitals.js":"3","/Users/eitatachino/Desktop/stripe-react/src/Checkout.js":"4","/Users/eitatachino/Desktop/stripe-react/src/Payments.js":"5","/Users/eitatachino/Desktop/stripe-react/src/Customers.js":"6","/Users/eitatachino/Desktop/stripe-react/src/Subscriptions.js":"7","/Users/eitatachino/Desktop/stripe-react/src/firebase.js":"8","/Users/eitatachino/Desktop/stripe-react/src/helpers.js":"9"},{"size":1291,"mtime":1611736030056,"results":"10","hashOfConfig":"11"},{"size":2421,"mtime":1612316010313,"results":"12","hashOfConfig":"11"},{"size":362,"mtime":1610072654214,"results":"13","hashOfConfig":"14"},{"size":2204,"mtime":1612313070525,"results":"15","hashOfConfig":"11"},{"size":3548,"mtime":1612313237141,"results":"16","hashOfConfig":"11"},{"size":4030,"mtime":1612314190658,"results":"17","hashOfConfig":"11"},{"size":5660,"mtime":1612314211178,"results":"18","hashOfConfig":"11"},{"size":543,"mtime":1611736066250,"results":"19","hashOfConfig":"11"},{"size":696,"mtime":1611756299654,"results":"20","hashOfConfig":"11"},{"filePath":"21","messages":"22","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"23"},"nhpgew",{"filePath":"24","messages":"25","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"26","messages":"27","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"28"},"bdbq7n",{"filePath":"29","messages":"30","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"23"},{"filePath":"31","messages":"32","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"23"},{"filePath":"33","messages":"34","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"35","usedDeprecatedRules":"23"},{"filePath":"36","messages":"37","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"38","usedDeprecatedRules":"23"},{"filePath":"39","messages":"40","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"41"},{"filePath":"42","messages":"43","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"23"},"/Users/eitatachino/Desktop/stripe-react/src/index.js",[],["44","45"],"/Users/eitatachino/Desktop/stripe-react/src/App.js",[],"/Users/eitatachino/Desktop/stripe-react/src/reportWebVitals.js",[],["46","47"],"/Users/eitatachino/Desktop/stripe-react/src/Checkout.js",[],"/Users/eitatachino/Desktop/stripe-react/src/Payments.js",[],"/Users/eitatachino/Desktop/stripe-react/src/Customers.js",["48"],"import React, { useState, useEffect, Suspense } from 'react'\nimport { fetchFromAPI } from './helpers'\nimport { CardElement, useStripe, useElements } from '@stripe/react-stripe-js'\nimport { useUser, AuthCheck } from 'reactfire'\nimport firebase from 'firebase/app'\n\nimport { auth, db } from './firebase'\n\nexport function SignIn() {\n  const signIn = async () => {\n    const credential = await auth.signInWithPopup(\n      new firebase.auth.GoogleAuthProvider()\n    )\n    const { uid, email } = credential.user\n    db.collection('users').doc(uid).set({ email }, { merge: true })\n  }\n\n  return (\n    <button className='btn btn-primary' onClick={signIn}>\n      Sign In with Google\n    </button>\n  )\n}\n\nexport function SignOut(props) {\n  return (\n    props.user && (\n      <button\n        className='btn btn-outline-secondary'\n        onClick={() => auth.signOut()}\n      >\n        Sign Out User {props.user.uid}\n      </button>\n    )\n  )\n}\n\nfunction SaveCard(props) {\n  const stripe = useStripe()\n  const elements = useElements()\n  const user = useUser()\n\n  const [setupIntent, setSetupIntent] = useState()\n  const [wallet, setWallet] = useState([])\n\n  // Get the user's wallet on mount\n  useEffect(() => {\n    getWallet()\n  }, [user])\n\n  // Create the setup intent\n  const createSetupIntent = async (event) => {\n    const si = await fetchFromAPI('wallet')\n    setSetupIntent(si)\n  }\n\n  // Handle the submission of card details\n  const handleSubmit = async (event) => {\n    event.preventDefault()\n\n    const cardElement = elements.getElement(CardElement)\n\n    // Confirm Card Setup\n    const {\n      setupIntent: updatedSetupIntent,\n      error,\n    } = await stripe.confirmCardSetup(setupIntent.client_secret, {\n      payment_method: { card: cardElement },\n    })\n\n    if (error) {\n      alert(error.message)\n      console.log(error)\n    } else {\n      setSetupIntent(updatedSetupIntent)\n      await getWallet()\n      alert('Success! Card added to your wallet')\n    }\n  }\n\n  const getWallet = async () => {\n    if (user) {\n      const paymentMethods = await fetchFromAPI('wallet', { method: 'GET' })\n      setWallet(paymentMethods)\n    }\n  }\n\n  return (\n    <>\n      <h2>Customers</h2>\n\n      <p>\n        Save credit card details for future use. Connect a Stripe Customer ID to\n        a Firebase User ID.\n      </p>\n\n      <AuthCheck fallback={<SignIn />}>\n        <div className='well'>\n          <h3>Step 1: Create a Setup Intent</h3>\n\n          <button\n            className='btn btn-success'\n            onClick={createSetupIntent}\n            hidden={setupIntent}\n          >\n            Attach New Credit Card\n          </button>\n        </div>\n        <hr />\n\n        <form\n          onSubmit={handleSubmit}\n          className='well'\n          hidden={!setupIntent || setupIntent.status === 'succeeded'}\n        >\n          <h3>Step 2: Submit a Payment Method</h3>\n          <p>Collect credit card details, then attach the payment source.</p>\n          <p>\n            Normal Card: <code>4242424242424242</code>\n          </p>\n          <p>\n            3D Secure Card: <code>4000002500003155</code>\n          </p>\n\n          <hr />\n\n          {/* <CardElement /> */}\n          <button className='btn btn-success' type='submit'>\n            Attach\n          </button>\n        </form>\n\n        <div className='well'>\n          <h3>Retrieve all Payment Sources</h3>\n          <select className='form-control'>\n            {wallet.map((paymentSource) => (\n              <CreditCard key={paymentSource.id} card={paymentSource.card} />\n            ))}\n          </select>\n        </div>\n        <div className='well'>\n          <SignOut user={user} />\n        </div>\n      </AuthCheck>\n    </>\n  )\n}\n\nfunction CreditCard(props) {\n  const { last4, brand, exp_month, exp_year } = props.card\n  return (\n    <option>\n      {brand} **** **** **** {last4} expires {exp_month}/{exp_year}\n    </option>\n  )\n}\n\nexport default function Customers() {\n  return (\n    <Suspense fallback={'loading user'}>\n      <SaveCard />\n    </Suspense>\n  )\n}\n","/Users/eitatachino/Desktop/stripe-react/src/Subscriptions.js",["49"],"import React, { useState, useEffect, Suspense } from 'react'\nimport { fetchFromAPI } from './helpers'\nimport { CardElement, useStripe, useElements } from '@stripe/react-stripe-js'\nimport { useUser, AuthCheck } from 'reactfire'\n\nimport { db } from './firebase'\nimport { SignIn, SignOut } from './Customers'\n\nfunction UserData(props) {\n  const [data, setData] = useState({})\n\n  // Subscribe to the user's data in Firestore\n  useEffect(() => {\n    const unsubscribe = db\n      .collection('users')\n      .doc(props.user.uid)\n      .onSnapshot((doc) => setData(doc.data()))\n    return () => unsubscribe()\n  }, [props.user])\n\n  return (\n    <pre>\n      Stripe Customer ID: {data.stripeCustomerId} <br />\n      Subscriptions: {JSON.stringify(data.activePlans || [])}\n    </pre>\n  )\n}\n\nfunction SubscribeToPlan(props) {\n  const stripe = useStripe()\n  const elements = useElements()\n  const user = useUser()\n\n  const [plan, setPlan] = useState()\n  const [subscriptions, setSubscriptions] = useState([])\n  const [loading, setLoading] = useState(false)\n\n  // Get current subscriptions on mount\n  useEffect(() => {\n    getSubscriptions()\n  }, [user])\n\n  // Fetch current subscriptions from the API\n  const getSubscriptions = async () => {\n    if (user) {\n      const subs = await fetchFromAPI('subscriptions', { method: 'GET' })\n      setSubscriptions(subs)\n    }\n  }\n\n  // Cancel a subscription\n  const cancel = async (id) => {\n    setLoading(true)\n    await fetchFromAPI('subscriptions/' + id, { method: 'PATCH' })\n    alert('canceled!')\n    await getSubscriptions()\n    setLoading(false)\n  }\n\n  // Handle the submission of card details\n  const handleSubmit = async (event) => {\n    setLoading(true)\n    event.preventDefault()\n\n    const cardElement = elements.getElement(CardElement)\n\n    // Create Payment Method\n    const { paymentMethod, error } = await stripe.createPaymentMethod({\n      type: 'card',\n      card: cardElement,\n    })\n\n    if (error) {\n      alert(error.message)\n      setLoading(false)\n      return\n    }\n\n    // Create Subscription on the Server\n    const subscription = await fetchFromAPI('subscriptions', {\n      body: {\n        plan,\n        payment_method: paymentMethod.id,\n      },\n    })\n\n    // The subscription contains an invoice\n    // If the invoice's payment succeeded then you're good,\n    // otherwise, the payment intent must be confirmed\n\n    const { latest_invoice } = subscription\n\n    if (latest_invoice.payment_intent) {\n      const { client_secret, status } = latest_invoice.payment_intent\n\n      if (status === 'requires_action') {\n        const { error: confirmationError } = await stripe.confirmCardPayment(\n          client_secret\n        )\n        if (confirmationError) {\n          console.error(confirmationError)\n          alert('unable to confirm card')\n          return\n        }\n      }\n\n      // success\n      alert('You are subscribed!')\n      getSubscriptions()\n    }\n\n    setLoading(false)\n    setPlan(null)\n  }\n\n  return (\n    <>\n      <h2>Subscriptions</h2>\n      <p>\n        Subscribe a user to a recurring plan, process the payment, and sync with\n        Firestore in realtime.\n      </p>\n      <AuthCheck fallback={<SignIn />}>\n        <div className='well'>\n          <h2>Firestore Data</h2>\n          <p>User's data in Firestore.</p>\n          {user?.uid && <UserData user={user} />}\n        </div>\n\n        <hr />\n\n        <div className='well'>\n          <h3>Step 1: Choose a Plan</h3>\n\n          <button\n            className={\n              'btn ' +\n              (plan === 'price_1ICGrfBtWDnvAXit1BICwiVz'\n                ? 'btn-primary'\n                : 'btn-outline-primary')\n            }\n            onClick={() => setPlan('price_1ICGrfBtWDnvAXit1BICwiVz')}\n          >\n            Choose Monthly ¥2500/月\n          </button>\n\n          <button\n            className={\n              'btn ' +\n              (plan === 'price_1ICGrfBtWDnvAXitYSPzmqCt'\n                ? 'btn-primary'\n                : 'btn-outline-primary')\n            }\n            onClick={() => setPlan('price_1ICGrfBtWDnvAXitYSPzmqCt')}\n          >\n            Choose Quarterly ¥5000/3ヶ月\n          </button>\n\n          <p>\n            Selected Plan: <strong>{plan}</strong>\n          </p>\n        </div>\n        <hr />\n\n        <form onSubmit={handleSubmit} className='well' hidden={!plan}>\n          <h3>Step 2: Submit a Payment Method</h3>\n          <p>Collect credit card details</p>\n          <p>\n            Normal Card: <code>4242424242424242</code>\n          </p>\n          <p>\n            3D Secure Card: <code>4000002500003155</code>\n          </p>\n\n          <hr />\n\n          <CardElement />\n          <button className='btn btn-success' type='submit' disabled={loading}>\n            Subscribe & Pay\n          </button>\n        </form>\n\n        <div className='well'>\n          <h3>Manage Current Subscriptions</h3>\n          <div>\n            {subscriptions.map((sub) => (\n              <div key={sub.id}>\n                {sub.id}. Next payment of {sub.plan.amount} due{' '}\n                {new Date(sub.current_period_end * 1000).toUTCString()}\n                <button\n                  className='btn btn-sm btn-danger'\n                  onClick={() => cancel(sub.id)}\n                  disabled={loading}\n                >\n                  Cancel\n                </button>\n              </div>\n            ))}\n          </div>\n        </div>\n\n        <div className='well'>\n          <SignOut user={user} />\n        </div>\n      </AuthCheck>\n    </>\n  )\n}\n\nexport default function Subscriptions() {\n  return (\n    <Suspense fallback={'loading user'}>\n      <SubscribeToPlan />\n    </Suspense>\n  )\n}\n","/Users/eitatachino/Desktop/stripe-react/src/firebase.js",[],["50","51"],"/Users/eitatachino/Desktop/stripe-react/src/helpers.js",[],{"ruleId":"52","replacedBy":"53"},{"ruleId":"54","replacedBy":"55"},{"ruleId":"52","replacedBy":"56"},{"ruleId":"54","replacedBy":"57"},{"ruleId":"58","severity":1,"message":"59","line":49,"column":6,"nodeType":"60","endLine":49,"endColumn":12,"suggestions":"61"},{"ruleId":"58","severity":1,"message":"62","line":41,"column":6,"nodeType":"60","endLine":41,"endColumn":12,"suggestions":"63"},{"ruleId":"52","replacedBy":"64"},{"ruleId":"54","replacedBy":"65"},"no-native-reassign",["66"],"no-negated-in-lhs",["67"],["66"],["67"],"react-hooks/exhaustive-deps","React Hook useEffect has a missing dependency: 'getWallet'. Either include it or remove the dependency array.","ArrayExpression",["68"],"React Hook useEffect has a missing dependency: 'getSubscriptions'. Either include it or remove the dependency array.",["69"],["66"],["67"],"no-global-assign","no-unsafe-negation",{"desc":"70","fix":"71"},{"desc":"72","fix":"73"},"Update the dependencies array to be: [getWallet, user]",{"range":"74","text":"75"},"Update the dependencies array to be: [getSubscriptions, user]",{"range":"76","text":"77"},[1221,1227],"[getWallet, user]",[1132,1138],"[getSubscriptions, user]"]